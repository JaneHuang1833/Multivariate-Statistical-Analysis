---
title: "R Notebook"
output:
  word_document: default
  html_notebook: default
  pdf_document: default
---

# 习题5.4

![](images/4d6b245ab6b0675a6b75104e9cfde563-01.jpg)

## Fisher判别法

```{r}
mu1 <- c(10, 15)
mu2 <- c(20, 25)

Sigma1 <- matrix(c(18, 12,
                   12, 32), nrow = 2, byrow = TRUE)

Sigma2 <- matrix(c(20, -7,
                   -7,  5), nrow = 2, byrow = TRUE)

# 观察值
X1 <- c(20, 20)
X2 <- c(15, 20)

# ----------------------------------
# Step 1: 组内离差矩阵 A = Σ1 + Σ2
# ----------------------------------
A <- Sigma1 + Sigma2
A

# ----------------------------------
# Step 2: 组间离差矩阵 B = (mu1 - mu2)(mu1 - mu2)'
# ----------------------------------
dmu <- mu1 - mu2
B <- dmu %*% t(dmu)
B

# ----------------------------------
# Step 3: 计算 A^{-1}
# ----------------------------------
A_inv <- solve(A)
A_inv

# ----------------------------------
# Step 4: 计算 d^2 = (mu1 - mu2)' A^{-1} (mu1 - mu2)
# ----------------------------------
d2 <- as.numeric(t(dmu) %*% A_inv %*% dmu)
d2   # 应为 4.7067

# ----------------------------------
# Step 5: Fisher 判别系数 a = A^{-1}(mu1 - mu2) / d
# ----------------------------------
d_val <- sqrt(d2)         # d
a_raw <- A_inv %*% dmu    # 未归一化
a <- -a_raw / d_val       # 与教材取相反方向一致（教材使用 -1/√(89765)*(32,33)）
a

# ----------------------------------
# Step 6: 判别函数 u(x) = a' x
# ----------------------------------
u <- function(x) { as.numeric(t(a) %*% x) }

u_mu1 <- -u(mu1)
u_mu2 <- -u(mu2)
u_mu1; u_mu2     # 对应教材 -2.7202 和 -4.8897

# ----------------------------------
# Step 7: 计算 σ1², σ2²
#        σi² = a' Σi a
# ----------------------------------
sigma1_sq <- as.numeric(t(a) %*% Sigma1 %*% a)
sigma2_sq <- as.numeric(t(a) %*% Sigma2 %*% a)
sigma1_sq; sigma2_sq     # 对应教材 0.8759 和 0.1241

sigma1 <- sqrt(sigma1_sq)
sigma2 <- sqrt(sigma2_sq)

sigma1
sigma2

# ----------------------------------
# Step 8: Fisher 判别阈值 u* = (σ2² u1_bar + σ1² u2_bar)/(σ1² + σ2²)
# ----------------------------------
u_star <- (sigma2*u_mu1 + sigma1*u_mu2) / (sigma1 + sigma2)
u_star   # ≈ -4.2964

# ----------------------------------
# Step 9: 对两个样本进行分类
# ----------------------------------
u_X1 <- -u(X1)
u_X2 <- -u(X2)

cat("u(X1) =", u_X1, "\n")
cat("u(X2) =", u_X2, "\n")
cat("u*    =", u_star, "\n\n")

if (u_X1 > u_star) {
  cat("X1 属于 G1\n")
} else {
  cat("X1 属于 G2\n")
}

if (u_X2 > u_star) {
  cat("X2 属于 G1\n")
} else {
  cat("X2 属于 G2\n")
}


```

## 贝叶斯准则

```{r}
Sigma <- matrix(c(18, 12,
                   12, 32), nrow = 2, byrow = TRUE)

# 先验损失比
L21 <- 75
L12 <- 10
ratio_const <- L21 / L12    # 75 / 10 = 7.5

# 统一均值 μ̄
mu_bar <- (mu1 + mu2) / 2        # (15,20)

# Σ^{-1}
Sigma_inv <- solve(Sigma)

# μ1 − μ2
dmu <- mu1 - mu2                 # (-10, -10)

# 公式： h1/h2 = 7.5 * exp{ (X - μ̄)' Σ^{-1} (μ1 - μ2) }
bayes_ratio <- function(X) {
  exp_term <- as.numeric(-t(X - mu_bar) %*% Sigma_inv %*% dmu)
  ratio <- ratio_const * exp(exp_term)
  return(ratio)
}

# 对 X1、X2 计算 h1/h2
ratio_X1 <- bayes_ratio(X1)
ratio_X2 <- bayes_ratio(X2)

cat("h1/h2 (X1) =", ratio_X1, "\n")   # 75.9229
cat("h1/h2 (X2) =", ratio_X2, "\n")   # 7.5

# 判别：若 h1(X) > h2(X) 则归 G1，否则 G2
if (ratio_X1 > 1) {
  cat("X1 属于 G2\n")
} else {
  cat("X1 属于 G1\n")   # 教材结论：属于 G2
}

if (ratio_X2 > 1) {
  cat("X2 属于 G2\n")
} else {
  cat("X2 属于 G1\n")   # 教材结论：属于 G2
}

```

## 计算后验概率

```{r}
q1 = q2 = 0.5
# 需要计算的点 x
x <- c(20, 20)

# ----------------------------------
# 1. 多元正态密度函数 
# ----------------------------------
dmvnorm_manual <- function(x, mu, Sigma) {
  p <- length(x)
  detS <- det(Sigma)
  invS <- solve(Sigma)
  
  coeff <- 1 / ((2*pi)^(p/2) * sqrt(detS))
  expo  <- exp( -0.5 * t(x - mu) %*% invS %*% (x - mu) )

  return(as.numeric(coeff * expo))
}

f1 <- dmvnorm_manual(x, mu1, Sigma1)
f2 <- dmvnorm_manual(x, mu2, Sigma2)

cat("f1(x) =", f1, "\n")
cat("f2(x) =", f2, "\n")

# ----------------------------------
# 2. Bayes 公式：后验概率
# ----------------------------------
P_G1_given_x <- q1 * f1 / (q1*f1 + q2*f2)
P_G2_given_x <- q2 * f2 / (q1*f1 + q2*f2)

cat("P(G1 | x) =", P_G1_given_x, "\n")
cat("P(G2 | x) =", P_G2_given_x, "\n")

```
